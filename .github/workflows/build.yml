name: Build Delta Force Helper

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup MSVC
      uses: ilammy/msvc-dev-cmd@v1
      with:
        arch: x86

    - name: Build with MSVC (cl.exe)
      run: |
        if (!(Test-Path Release)) { New-Item -ItemType Directory -Force -Path Release }
        
        # 将 EasyXa.lib (或你上传的 EasyXw.lib) 附加到链接库列表中
        # 确保 graphics.h, easyx.h 和 EasyXa.lib 已经 Push 到了代码仓库的根目录
        cl.exe /EHsc /O2 /MD /Fe"Release\DeltaForceNormalPlayerHelper.exe" *.cpp Advapi32.lib Ole32.lib User32.lib Shell32.lib EasyXa.lib
      shell: pwsh

    - name: Prepare Artifacts
      run: |
        New-Item -ItemType Directory -Force -Path ReleasePack
        Copy-Item Release\DeltaForceNormalPlayerHelper.exe ReleasePack\
        
        Copy-Item -Path PicRes -Destination ReleasePack\PicRes -Recurse -Force
        
        if (Test-Path LICENSE) { Copy-Item LICENSE ReleasePack\ } else { Write-Host "No LICENSE found" }
        if (Test-Path README.md) { Copy-Item README.md ReleasePack\ } else { Write-Host "No README found" }
      shell: pwsh

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: DeltaForceNormalPlayerHelper-Release
        path: ReleasePack/
